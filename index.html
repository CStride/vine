<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VINE</title>
    <link rel="icon" href="./assets/icon-favicon.png"/>
    <link rel="stylesheet" type="text/css" href="./index.css"/>
    <link rel="stylesheet" type="text/css" href="./style/main.css"/>
</head>
<body>
    <div id="layout">
        <div id="top"></div>
        <div id="center">
            <span id="title">VINE</span>
            <div id="search-box">
                <div id="search-engine"></div>
                <input id="input-box" type="text" placeholder="Search or type a URL"/>
                <img id="icon-searching" class="icon" src="./assets/searching.png"/>
            </div>
            <div id="QLink-List">
                <button id="addshortcut" title="add shortcut">
                    <div class="iconContainer">
                        <img id="icon-addshortcut" src="./assets/addshortcut.png"/>
                    </div>
                    <div class="titleContainer">
                        <span>addshortcut</span>
                    </div>
                </button>

                <div id="actionmenu">
                    <button class="menu-item edit">Edit</button>
                    <button class="menu-item remove">Remove</button>
                </div>
            </div>
        </div>
    </div>
    <div id="addshortcut-dialog">
        <span>Add shortcut</span>
        <div id="dialogItem-container">
            <div class="dialog-item">
                <span>Name</span>
                <input id="dialogInput-name" type="text"/>
            </div>
            <div class="dialog-item">
                <span>URL</span>
                <input id="dialogInput-url" type="text"/>
            </div>
        </div>
        <div id="dialogButton-container">
            <button id="dialog-done">Done</button>
            <button id="dialog-cancle">Cancle</button>
        </div>
    </div>
    <div id="overlay"></div>
    <script type="module">
        import { initializeData } from "./data/initData.js"

        // initialize dom

        // initialize data
        initializeData();


        // set listeners
        const nodes_actionmenuTrigger = document.getElementsByClassName("actionmenu-trigger");
        const actionmenuTriggers = Array.from(nodes_actionmenuTrigger);
        actionmenuTriggers.forEach((actionmenuTrigger) => {
            actionmenuTrigger.addEventListener("click", openActionmenu);
        })

        const node_actionmemu = document.getElementById("actionmenu");
        // node_actionmemu.addEventListener("blur", closeActionmenu);
        node_actionmemu.onblur = closeActionmenu;

        const node_addshortcut = document.querySelector("#addshortcut");
        node_addshortcut.addEventListener("click", openAddShortcutDialog);

        const node_dialogcancle = document.querySelector("#dialog-cancle");
        const node_overlay = document.querySelector("#overlay");
        node_dialogcancle.addEventListener("click", closeAddShortcutDialog);
        node_overlay.addEventListener("click", closeAddShortcutDialog);

        const node_dialogdone = document.querySelector("#dialog-done");
        node_dialogdone.addEventListener("click", addShortcut);

        // ADDSHORTCUT.addEventListener("blur", closeAddShortcutDialog);

        // functions
        function openAddShortcutDialog() {
            const dialog = document.getElementById("addshortcut-dialog");
            const overlay = document.getElementById("overlay");

            dialog.style.display = "block";
            overlay.style.display = "block";
        }

        function closeAddShortcutDialog() {
            const dialog = document.getElementById("addshortcut-dialog");
            const overlay = document.getElementById("overlay");

            const input_name = document.getElementById("dialogInput-name");
            const input_url = document.getElementById("dialogInput-url");
            input_name.value = "";
            input_url.value = "";

            dialog.style.display = "none";
            overlay.style.display = "none";
        }

        function addShortcut() {
            const input_name = document.getElementById("dialogInput-name");
            const input_url = document.getElementById("dialogInput-url");

            const name = input_name.value;
            const url = input_url.value;

            console.log(name, url);
            closeAddShortcutDialog();
        }

        function openActionmenu(event) {
            event.preventDefault();
            event.stopPropagation();

            const toggle = event.target;
            const QLink = toggle.parentNode;
            const relativeX = QLink.offsetLeft;
            const relativeY = QLink.offsetTop;


            const actionmemu = document.getElementById("actionmenu");
            actionmemu.style.display = "block";
            actionmemu.style.top = relativeY + "px";
            actionmemu.style.left = (relativeX - (actionmemu.offsetWidth - QLink.offsetWidth) / 2) + "px";
            
            // console.log(event)
        }

        function closeActionmenu() {
            const actionmemu = document.getElementById("actionmenu");
            console.log(actionmemu)
            actionmemu.style.display = "none";
            console.log(actionmemu.style.display)
        }
    </script>
</body>
</html>